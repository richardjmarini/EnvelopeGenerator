.SUBCKT LM393 INP INM VCC VEE OUT

* Smooth comparator transfer (tanh avoids discontinuity)
BCTRL CTRL 0 V = { 0.5*(1 + tanh(100*(V(INP,INM)))) }

* Make CTRL a real node
RCTRL CTRL 0 100k
CCTRL CTRL 0 1p

* Open collector switch
.model SW_OC SW(Ron=100 Roff=1e12 Vt=0.5 Vh=0)
SOUT OUT VEE CTRL 0 SW_OC

.ENDS LM393

