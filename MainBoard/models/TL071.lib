* TL071 Operational Amplifier – ngspice-stable macromodel
* Pins: 1 = +IN, 2 = –IN, 3 = V+, 4 = V–, 5 = OUT

.SUBCKT TL071 1 2 3 4 5

*--------------------------------------------------
* Input JFET differential pair (simplified)
*--------------------------------------------------
J1 11 2 10 JX
J2 12 1 10 JX

ISS 3 10 DC 195u
RD1 4 11 3.5k
RD2 4 12 3.5k

*--------------------------------------------------
* Differential to single-ended conversion
*--------------------------------------------------
GDIFF 6 0 11 12 300u
RDIFF 6 0 100k

*--------------------------------------------------
* Dominant pole
*--------------------------------------------------
Cdom 6 7 15p
Rdom 7 0 1Meg

*--------------------------------------------------
* High-gain voltage stage (buffered)
*--------------------------------------------------
EGAIN 8 0 6 0 1e5
RGAIN 8 0 100k

*--------------------------------------------------
* Output swing limiter (rail-referenced)
*--------------------------------------------------
* headroom ≈ 2V from rails (TL071 typical)
ECLAMP 9 0 VALUE = { LIMIT( V(8), V(4)+2, V(3)-2 ) }

*--------------------------------------------------
* Output buffer & impedance
*--------------------------------------------------
EOUT 5 0 9 0 1
ROUT 5 0 75

*--------------------------------------------------
* DC anchors (prevent singular matrices)
*--------------------------------------------------
RANCH1 11 0 100Meg
RANCH2 12 0 100Meg
RANCH3 8  0 100Meg
RANCH4 9  0 100Meg

*--------------------------------------------------
.MODEL JX PJF(IS=15p BETA=270u VTO=-1)

.ENDS TL071

